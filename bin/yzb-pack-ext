#!/usr/bin/env node

const fs = require('fs');
const packageJson = require('./package.json');
const { zipDirectory } = require('../src/common-function');

function packageExtension() {
    // !删除package文件
    fs.rmSync('package', { recursive: true, force: true });
    // !只安装运行依赖
    console.log("安装运行依赖!");
    stdout = execSync('cd dist && npm install --omit=dev');
    // !创建package目录
    console.log("创建package目录!");
    fs.mkdirSync('package');
    // !获取生成extension压缩包名称
    const extensionZipFileName = `package/${packageJson.name}_${packageJson.version}.zip`;
    // !压缩extension.zip
    console.log("创建extension压缩包!");
    zipDirectory('dist', extensionZipFileName).then(() => {
        console.log(`打包成功,打包文件路径:${extensionZipFileName}!`);
    }).catch((error) => {
        console.log(`打包失败`);
        console.error(error);
    });
}

packageExtension();